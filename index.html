<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bruce JS Designer</title>
<style>
body {
  margin:0; padding:16px;
  background:#1a0033; color:#fff;
  font-family:'Segoe UI',sans-serif;
}
.container { max-width:960px; margin:auto; }
h1 { text-align:center; margin-bottom:12px; }
canvas { display:block; margin:0 auto 12px; background:#000; border-radius:6px; image-rendering:pixelated; }
.panel { background:#2b0055; padding:16px; border-radius:12px; }
.sliders { display:flex; flex-wrap:wrap; gap:12px; }
.sliders label { flex:1 1 45%; display:flex; flex-direction:column; }
.slider-control { display:flex; align-items:center; gap:4px; margin-top:4px; }
input, select { width:100%; padding:6px; border-radius:8px; border:none; background:#4b2e83; color:#fff; }
.buttons { display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; }
button { flex:1 1 140px; padding:10px; border:none; border-radius:10px; background:#6c43b2; color:#fff; font-weight:bold; cursor:pointer; }
button:hover { background:#8457d6; }
.danger { background:#ff4d6d; } .danger:hover { background:#ff1a3c; }
.export { background:#4dff88; color:#000; } .export:hover { background:#2cff70; }
.value-box { width:40px; text-align:center; background:#000; border:1px solid #4b2e83; border-radius:6px; padding:2px; }
code { display:block; background:#2b0055; border:1px solid #4b2e83; padding:12px; border-radius:8px; white-space:pre-wrap; margin-top:12px; max-height:300px; overflow:auto; }
.credits { position:fixed; bottom:8px; right:16px; font-size:0.8rem; }
@media(max-width:600px){ .sliders label { flex:1 1 100%; } button { flex:1 1 48%; } }
</style>
</head>
<body>
<div class="container">
<h1>Bruce JS Designer</h1>

<canvas id="screen" width="320" height="170"></canvas>

<label>Device:
  <select id="device">
    <option value="240x135">M5StickC / Cardputer</option>
    <option value="320x170" selected>LilyGO T-Embed</option>
  </select>
</label>

<div class="panel">
  <div class="sliders">
    <label>X
      <div class="slider-control">
        <input type="range" id="x" min="0" max="320">
        <button id="xMinus">-</button>
        <button id="xPlus">+</button>
        <span class="value-box" id="xVal">0</span>
      </div>
    </label>
    <label>Y
      <div class="slider-control">
        <input type="range" id="y" min="0" max="170">
        <button id="yMinus">-</button>
        <button id="yPlus">+</button>
        <span class="value-box" id="yVal">0</span>
      </div>
    </label>
    <label>Width
      <div class="slider-control">
        <input type="range" id="w" min="1" max="320">
        <button id="wMinus">-</button>
        <button id="wPlus">+</button>
        <span class="value-box" id="wVal">0</span>
      </div>
    </label>
    <label>Height
      <div class="slider-control">
        <input type="range" id="h" min="1" max="170">
        <button id="hMinus">-</button>
        <button id="hPlus">+</button>
        <span class="value-box" id="hVal">0</span>
      </div>
    </label>
    <label>Text
      <input type="text" id="text">
    </label>
    <label>Text Size
      <div class="slider-control">
        <input type="range" id="textSize" min="1" max="6">
        <button id="textMinus">-</button>
        <button id="textPlus">+</button>
        <span class="value-box" id="textVal">1</span>
      </div>
    </label>
    <label>Color
      <input type="color" id="color">
    </label>
    <label>Shape
      <select id="shapeSelect"></select>
    </label>
    <label>File name
      <input type="text" id="fileName" value="app">
    </label>
  </div>

  <div class="buttons">
    <button onclick="addItem('fillRect')">FillRect</button>
    <button onclick="addItem('rect')">Rect</button>
    <button onclick="addItem('line')">Line</button>
    <button onclick="addItem('circle')">Circle</button>
    <button onclick="addItem('fillCircle')">FillCircle</button>
    <button onclick="addItem('text')">Text</button>
    <button class="danger" onclick="deleteItem()">Delete</button>
    <button class="export" onclick="exportJS()">Export JS</button>
  </div>
</div>

<code id="code"></code>

<div class="credits">
  <a href="https://github.com/sloth" target="_blank" style="color:#aaa;text-decoration:none">
    Made by SLOTH
  </a>
</div>
</div>

<script>
const canvas = document.getElementById("screen");
const ctx = canvas.getContext("2d");

const deviceSelect = document.getElementById("device");

let items = [];
let selected = null;

function setDeviceSize(){
  const val = deviceSelect.value.split("x");
  canvas.width = +val[0]; canvas.height = +val[1];
}
deviceSelect.addEventListener("change", ()=>{
  setDeviceSize(); render();
});
setDeviceSize();

function addItem(type){
  let obj = {type, x:40, y:40, w:40, h:40, size:2, color:"#ffffff", text:"Hello"};
  if(type.includes("circle")) obj.w=20;
  items.push(obj); selected=obj; render();
}

function deleteItem(){ if(!selected) return; items = items.filter(i=>i!==selected); selected=null; render(); }

function render(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,canvas.width,canvas.height);
  items.forEach(i=>{
    ctx.strokeStyle=ctx.fillStyle=i.color; ctx.lineWidth=2;
    if(i.type==="fillRect") ctx.fillRect(i.x,i.y,i.w,i.h);
    if(i.type==="rect") ctx.strokeRect(i.x,i.y,i.w,i.h);
    if(i.type==="line"){ ctx.beginPath(); ctx.moveTo(i.x,i.y); ctx.lineTo(i.x+i.w,i.y+i.h); ctx.stroke(); }
    if(i.type==="circle"){ ctx.beginPath(); ctx.arc(i.x,i.y,i.w,0,Math.PI*2); ctx.stroke(); }
    if(i.type==="fillCircle"){ ctx.beginPath(); ctx.arc(i.x,i.y,i.w,0,Math.PI*2); ctx.fill(); }
    if(i.type==="text"){ ctx.font=`${i.size*8}px Arial`; ctx.fillText(i.text,i.x,i.y); }
  });
  syncUI(); generateCode();
}

function syncUI(){
  if(!selected) return;
  document.getElementById("x").value = selected.x;
  document.getElementById("y").value = selected.y;
  document.getElementById("w").value = selected.w;
  document.getElementById("h").value = selected.h;
  document.getElementById("text").value = selected.text||"";
  document.getElementById("textSize").value = selected.size;
  document.getElementById("color").value = selected.color;

  document.getElementById("xVal").textContent=selected.x;
  document.getElementById("yVal").textContent=selected.y;
  document.getElementById("wVal").textContent=selected.w;
  document.getElementById("hVal").textContent=selected.h;
  document.getElementById("textVal").textContent=selected.size;

  const sel = shapeSelect; sel.innerHTML="";
  items.forEach((i,idx)=>{
    const o=document.createElement("option");
    o.value=idx; o.text=`${i.type} ${idx+1}`;
    if(i===selected) o.selected=true;
    sel.appendChild(o);
  });
}

["x","y","w","h","text","textSize","color"].forEach(id=>{
  document.getElementById(id).addEventListener("input",()=>{
    if(!selected) return;
    if(id==="textSize") selected.size=+textSize.value;
    else if(id==="text") selected.text=text.value;
    else if(id==="color") selected.color=color.value;
    else selected[id]=+document.getElementById(id).value;
    render();
  });
});

// +/- buttons
const btns = [["x","xMinus","xPlus"],["y","yMinus","yPlus"],["w","wMinus","wPlus"],["h","hMinus","hPlus"],["textSize","textMinus","textPlus"]];
btns.forEach(([prop,minus,plus])=>{
  document.getElementById(minus).onclick=()=>{ if(selected){ selected[prop]-=1; render(); } };
  document.getElementById(plus).onclick=()=>{ if(selected){ selected[prop]+=1; render(); } };
});

// RGB converter
function rgb(hex){ hex=hex.replace("#",""); return [parseInt(hex.substr(0,2),16),parseInt(hex.substr(2,2),16),parseInt(hex.substr(4,2),16)]; }

// Generate JS code with loop & keyboard
function generateCode(){
  let out =
`var keyboard = require("keyboard");
var display = require("display");

var sprite = display.createSprite();

while (true) {

    if (keyboard.getEscPress(true)) break;

    sprite.fill(0);
`;

  items.forEach(i=>{
    const c = rgb(i.color).join(",");
    if(i.type==="fillRect") out+=`    sprite.drawFillRect(${i.x},${i.y},${i.w},${i.h},display.color(${c}));\n`;
    if(i.type==="rect") out+=`    sprite.drawRect(${i.x},${i.y},${i.w},${i.h},display.color(${c}));\n`;
    if(i.type==="line") out+=`    sprite.drawLine(${i.x},${i.y},${i.x+i.w},${i.y+i.h},display.color(${c}));\n`;
    if(i.type==="circle") out+=`    sprite.drawCircle(${i.x},${i.y},${i.w},display.color(${c}));\n`;
    if(i.type==="fillCircle") out+=`    sprite.drawFillCircle(${i.x},${i.y},${i.w},display.color(${c}));\n`;
    if(i.type==="text"){
      out+=`    sprite.setTextSize(${i.size});
    sprite.setTextColor(${c});
    sprite.drawText("${i.text}",${i.x},${i.y});
`;
    }
  });

  out+=`
    sprite.pushSprite();
}
`;
  code.textContent = out;
}

// Export JS
function exportJS(){
  const name = document.getElementById("fileName").value||"app";
  const blob = new Blob([code.textContent], {type:"text/javascript"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = name+".js";
  a.click();
}

shapeSelect.onchange=e=>{ selected=items[e.target.value]; syncUI(); };
render();
</script>
</body>
</html>
